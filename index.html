<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Time Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{ --brand:#08F7FE; --brand2:#F806CC; --glass:rgba(12,14,25,.6); --stroke:rgba(8,247,254,.45); }
    body{ min-height:100vh; color:#E6F1FF; background:
      radial-gradient(1200px 600px at 50% -10%, rgba(248,6,204,.25), transparent 60%),
      radial-gradient(1000px 500px at 20% 0%, rgba(8,247,254,.15), transparent 60%),
      linear-gradient(180deg,#0b0f1a 0%,#090d16 60%,#070a12 100%);
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .card{ border-radius:1rem; border:1px solid rgba(255,255,255,.06); background:var(--glass); backdrop-filter:blur(8px);
      box-shadow:0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.03); }
    .btn{ padding:.8rem 1.1rem; border-radius:1rem; font-weight:800; letter-spacing:.2px; border:1px solid rgba(255,255,255,.08) }
    .btn-primary{ color:#031015; background:linear-gradient(135deg,var(--brand),#6CF9FF 30%,var(--brand2) 100%);
      box-shadow:0 6px 18px rgba(8,247,254,.25), 0 0 0 1px rgba(8,247,254,.35) inset }
    .btn-ghost{ color:#cfe9ff; background:rgba(255,255,255,.06); }
    .field{ width:100%; padding:1rem 1rem; border-radius:1rem; border:1px solid rgba(255,255,255,.14); background:rgba(7,10,18,.7); color:#E6F1FF; font-size:1rem }
    .field:focus{ outline:none; box-shadow:0 0 0 3px var(--stroke) }
    .pill{ font-size:.9rem; padding:.45rem .75rem; border-radius:999px; background:rgba(255,255,255,.06); border:1px solid rgba(8,247,254,.25) }
    .mono{ font-feature-settings:"tnum" on; font-variant-numeric:tabular-nums; }
    .title{ font-family:'Orbitron', system-ui; font-weight:900; letter-spacing:.02em; line-height:1.05;
      background:linear-gradient(180deg,#fff 0%,#d2f7ff 30%,#9be7ff 50%,#a7a7a7 60%,#ffffff 100%);
      -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow:0 3px 0 rgba(0,0,0,.35), 0 0 24px rgba(8,247,254,.2); }
    button, input{ min-height:48px }
  </style>
</head>
<body>
  <main class="max-w-4xl mx-auto p-4 sm:p-6 md:p-8 space-y-6">
    <!-- HEADER -->
    <header class="card p-5">
      <div class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4">
        <h1 class="title text-3xl">Time Tracker</h1>
        <div class="flex items-center gap-2">
          <label class="text-sm text-sky-200/90">Week of</label>
          <input id="weekStart" type="date" class="field mono w-auto" />
        </div>
      </div>
      <p class="text-sm text-sky-100/80 mt-2">Saves only on this device. Private until you download or email.</p>
    </header>

    <!-- RATE -->
    <section class="card p-4">
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 items-end">
        <div>
          <label class="text-sm text-sky-200/90">Hourly Rate ($/hr)</label>
          <input id="rate" type="number" step="0.01" min="0" class="field mono" placeholder="25" />
        </div>
        <div class="sm:col-span-2 text-sky-100/80 text-sm">
          Used to calculate dollars. You can set a flat amount per line if needed.
        </div>
      </div>
    </section>

    <!-- ADD ENTRY -->
    <section class="card p-4">
      <form id="entryForm" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-3">
        <div class="lg:col-span-2">
          <label class="text-sm text-sky-200/90">What was completed?</label>
          <input id="task" class="field" placeholder="e.g., Mowed front lawn" required />
        </div>
        <div>
          <label class="text-sm text-sky-200/90">Date</label>
          <input id="date" type="date" class="field mono" required />
        </div>
        <div>
          <label class="text-sm text-sky-200/90">Time In</label>
          <input id="timeIn" type="time" class="field mono" required />
        </div>
        <div>
          <label class="text-sm text-sky-200/90">Time Out</label>
          <input id="timeOut" type="time" class="field mono" required />
        </div>
        <div>
          <label class="text-sm text-sky-200/90">Amount (optional)</label>
          <input id="amountOverride" type="number" step="0.01" min="0" class="field mono" placeholder="leave blank to use rate" />
        </div>
        <div class="flex items-end">
          <button type="submit" class="btn btn-primary w-full">Add Entry</button>
        </div>
      </form>
      <p id="formMsg" class="mt-2 text-sm"></p>
    </section>

    <!-- TABLE + TOTALS -->
    <section class="card p-3">
      <div class="flex items-center justify-between px-2 py-2">
        <h2 class="font-extrabold">Entries</h2>
        <div class="pill mono">This week: <span id="weekTotal">0.00</span> hrs | $<span id="weekValue">0.00</span></div>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full text-base">
          <thead>
            <tr class="text-left bg-white/5">
              <th class="p-2">Date</th>
              <th class="p-2">Completed</th>
              <th class="p-2">Time In</th>
              <th class="p-2">Time Out</th>
              <th class="p-2">Hours</th>
              <th class="p-2">Amount ($)</th>
              <th class="p-2">Action</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </section>

    <!-- ACTIONS -->
    <section class="card p-4">
      <div class="flex flex-wrap gap-3">
        <input id="sendTo" class="field mono flex-1" placeholder="recipient@example.com" aria-label="Email to send summary" />
        <button id="sendBtn" class="btn btn-primary">Send week by email</button>
        <button id="downloadBtn" class="btn btn-ghost">Download CSV</button>
      </div>
    </section>

    <footer class="text-center text-sm text-sky-100/80">Time Tracker • No logins • Simple and fast</footer>
  </main>

  <script>
    // Basic helpers
    const $ = id => document.getElementById(id);
    const todayStr = () => new Date().toISOString().slice(0,10);
    const toMin = t => { if(!t) return null; const [h,m]=t.split(':').map(Number); return h*60+m; };
    const minToHours = m => m/60;
    const startOfWeek = d => { const x=new Date(d.getFullYear(), d.getMonth(), d.getDate()); const day=x.getDay(); const diff=(day===0?-6:1-day); x.setDate(x.getDate()+diff); return x; };
    const sameWeek = (a,b) => startOfWeek(a).toDateString()===startOfWeek(b).toDateString();
    const fmtDate = d => d.toISOString().slice(0,10);

    // Local storage
    const KEY='time_tracker_entries_v1', RATE_KEY='time_tracker_rate';
    const loadEntries = () => { try { return JSON.parse(localStorage.getItem(KEY)) || []; } catch { return []; } };
    const saveEntries = d => localStorage.setItem(KEY, JSON.stringify(d));
    const loadRate = () => { const r=parseFloat(localStorage.getItem(RATE_KEY)); return isFinite(r)?r:25; };
    const saveRate = v => localStorage.setItem(RATE_KEY, String(v));

    let entries = loadEntries();

    // Init defaults
    $('date').value = todayStr();
    $('rate').value = loadRate();
    $('weekStart').value = fmtDate(startOfWeek(new Date()));

    function render(){
      const tbody=$('tbody'); 
      tbody.innerHTML='';
      const rate = parseFloat($('rate').value)||0;
      const selectedWeek=new Date($('weekStart').value);
      let weekMin=0, weekAmt=0;

      entries.sort((a,b)=>a.date.localeCompare(b.date)).forEach((e,i)=>{
        const d=new Date(e.date+'T00:00:00');
        const inWeek=sameWeek(d,selectedWeek);
        const hours=Number(e.hours||0);
        const amount=(e.amountOverride!=='' && e.amountOverride!=null)
          ? Number(e.amountOverride)
          : Number((hours*rate).toFixed(2));
        
        if(inWeek){ 
          weekMin += Math.round(hours*60); 
          weekAmt += amount; 
        }
        
        const tr=document.createElement('tr');
        tr.className = inWeek ? 'hover:bg-white/5' : 'opacity-50';
        tr.innerHTML = `
          <td class="p-2 mono">${e.date}</td>
          <td class="p-2">${e.task}</td>
          <td class="p-2 mono">${e.timeIn}</td>
          <td class="p-2 mono">${e.timeOut}</td>
          <td class="p-2 mono">${hours.toFixed(2)}</td>
          <td class="p-2 mono">${(e.amountOverride!==''&&e.amountOverride!=null)?Number(e.amountOverride).toFixed(2):amount.toFixed(2)}</td>
          <td class="p-2"><button class="btn btn-ghost text-sm delete-btn" data-idx="${i}">Delete</button></td>`;
        tbody.appendChild(tr);
      });

      $('weekTotal').textContent = minToHours(weekMin).toFixed(2);
      $('weekValue').textContent = weekAmt.toFixed(2);

      // Delete handlers
      document.querySelectorAll('.delete-btn').forEach(b=>{
        b.onclick = () => { 
          const i=Number(b.getAttribute('data-idx')); 
          entries.splice(i,1); 
          saveEntries(entries); 
          render(); 
        };
      });
    }

    render();

    // Add entry
    $('entryForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const task=$('task').value.trim();
      const date=$('date').value, tin=$('timeIn').value, tout=$('timeOut').value;
      const amt=$('amountOverride').value;
      
      if(!task||!date||!tin||!tout){ 
        msg('Please fill all required fields.', true); 
        return; 
      }
      
      // Validate date format
      if(!/^\d{4}-\d{2}-\d{2}$/.test(date)) {
        msg('Please enter a valid date.', true);
        return;
      }
      
      const minIn=toMin(tin), minOut=toMin(tout);
      if(minOut<=minIn){ 
        msg('Time Out must be after Time In.', true); 
        return; 
      }
      
      const hours=(minOut-minIn)/60;
      entries.push({ 
        task, 
        date, 
        timeIn:tin, 
        timeOut:tout, 
        hours:Number(hours.toFixed(2)), 
        amountOverride: amt?Number(parseFloat(amt).toFixed(2)):'' 
      });
      
      saveEntries(entries);
      $('weekStart').value = fmtDate(startOfWeek(new Date(date+'T00:00:00'))); // jump to week of entry
      $('task').value=''; $('timeIn').value=''; $('timeOut').value=''; $('amountOverride').value='';
      msg('Added ✔'); 
      render();
    });

    // Simple status message
    function msg(t, err=false){ 
      const el=$('formMsg'); 
      el.textContent=t; 
      el.className=`mt-2 text-sm ${err?'text-rose-300':'text-emerald-300'}`; 
      setTimeout(()=>{ el.textContent=''; }, 1500); 
    }

    // Week + rate react
    $('weekStart').addEventListener('change', render);
    $('rate').addEventListener('input', ()=>{ 
      const v=parseFloat($('rate').value); 
      if(isFinite(v)&&v>=0){ 
        saveRate(v); 
        render(); 
      } 
    });

    // CSV Download
    $('downloadBtn').onclick = () => {
      const selectedWeek = new Date($('weekStart').value);
      const rate = parseFloat($('rate').value)||0;
      const rows = [["Date","Completed","Time In","Time Out","Hours","Amount ($)"]];
      
      entries.filter(e=>sameWeek(new Date(e.date+'T00:00:00'), selectedWeek)).forEach(e=>{
        const amt=(e.amountOverride!==''&&e.amountOverride!=null)?Number(e.amountOverride):Number((e.hours*rate).toFixed(2));
        rows.push([e.date, e.task, e.timeIn, e.timeOut, e.hours.toFixed(2), amt.toFixed(2)]);
      });
      
      const csv = rows.map(r=>r.map(v=>String(v).replaceAll('"','""')).map(v=>`"${v}"`).join(',')).join('\n');
      const blob=new Blob([csv],{type:'text/csv'}); 
      const a=document.createElement('a');
      const s=startOfWeek(new Date($('weekStart').value)); 
      const e=new Date(s); 
      e.setDate(e.getDate()+6);
      a.href=URL.createObjectURL(blob); 
      a.download=`time-tracker-${fmtDate(s)}-to-${fmtDate(e)}.csv`; 
      a.click(); 
      URL.revokeObjectURL(a.href);
    };

    // Email Summary
    $('sendBtn').onclick = () => {
      const email = $('sendTo').value.trim() || '';
      const selectedWeek=new Date($('weekStart').value); 
      const s=startOfWeek(selectedWeek); 
      const e=new Date(s); 
      e.setDate(e.getDate()+6);
      const rate = parseFloat($('rate').value)||0;
      const weekEntries = entries.filter(en=>sameWeek(new Date(en.date+'T00:00:00'), selectedWeek));
      
      if(weekEntries.length===0){ 
        alert('No entries for this week.'); 
        return; 
      }
      
      const totalHours = weekEntries.reduce((sum,en)=>sum+Number(en.hours||0),0).toFixed(2);
      const totalAmount = weekEntries.reduce((sum,en)=> sum + ((en.amountOverride!==''&&en.amountOverride!=null)? Number(en.amountOverride) : Number((en.hours*rate).toFixed(2))), 0).toFixed(2);
      
      const lines = weekEntries.map(en=>{
        const amt=(en.amountOverride!==''&&en.amountOverride!=null)? Number(en.amountOverride).toFixed(2) : Number((en.hours*rate).toFixed(2)).toString();
        return `• ${en.date} – ${en.task} (${en.timeIn}–${en.timeOut}) = ${Number(en.hours).toFixed(2)}h = $${amt}`;
      });
      
      const body = [
        `Time Tracker weekly summary for ${fmtDate(s)} → ${fmtDate(e)}.`,
        '',
        ...lines,
        '',
        `Total: ${totalHours} hrs = $${totalAmount}`,
        '',
        '— Sent from Time Tracker'
      ].join('\n');
      
      const mailto = `mailto:${encodeURIComponent(email)}?subject=${encodeURIComponent('Time Tracker – '+fmtDate(s)+' → '+fmtDate(e))}&body=${encodeURIComponent(body)}`;
      window.location.href = mailto;
    };
  </script>
</body>
</html>
